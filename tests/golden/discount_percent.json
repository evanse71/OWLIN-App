{
  "scenario": "percent_discount",
  "description": "Tia Maria case: unit £60.55 → nett £32.22",
  "expected_discount": {
    "kind": "percent",
    "value": 46.8,
    "tolerance": 1.0
  },
  "invoice": {
    "supplier_id": "TEST_SUPPLIER",
    "invoice_date": "2024-01-15",
    "lines": [
      {
        "id": 1,
        "sku_id": "TIA_MARIA_001",
        "description": "Tia Maria 70cl",
        "quantity": 1.0,
        "unit_price": 60.55,
        "line_total": 32.22,
        "uom_key": "volume_ml",
        "date": "2024-01-15",
        "supplier_id": "TEST_SUPPLIER",
        "ruleset_id": 1
      }
    ]
  },
  "expected_verdict": "off_contract_discount",
  "expected_flags": ["OFF_CONTRACT_DISCOUNT"],
  "test_cases": [
    {
      "name": "exact_match",
      "input": {
        "qty": 1.0,
        "unit_price": 60.55,
        "nett_value": 32.22,
        "description": "Tia Maria 70cl"
      },
      "expected": {
        "discount_kind": "percent",
        "discount_value": 46.8,
        "residual_pennies": 0,
        "verdict": "off_contract_discount"
      }
    },
    {
      "name": "within_tolerance",
      "input": {
        "qty": 1.0,
        "unit_price": 60.55,
        "nett_value": 32.50,
        "description": "Tia Maria 70cl"
      },
      "expected": {
        "discount_kind": "percent",
        "discount_value": 46.3,
        "residual_pennies": 28,
        "verdict": "off_contract_discount"
      }
    }
  ]
} 